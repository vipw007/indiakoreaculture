rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Secure, baseline rules for collections inferred from the project structure.
    match /privateRooms/{roomId}/{document=**} {
       allow read, write: if request.auth != null;
    }
    match /users/{userId}/{document=**} {
       allow read, write: if request.auth != null;
    }
    match /blogs/{blogId}/{document=**} {
       allow read, write: if request.auth != null;
    }
    match /groupChats/{chatId}/{document=**} {
       allow read, write: if request.auth != null;
    }

    // Rules for community page. Allows ANYONE to read the list of rooms and sessions.
    match /communityRooms/{documentId} {
      allow read: if true;
    }
    match /upcomingSessions/{documentId} {
      allow read: if true;
    }

    // Rules for the 'calls' collection for WebRTC signaling
    // TEMPORARY DEBUGGING RULE: Allow any authenticated user to read/write.
    match /calls/{callId}/{document=**} {
      allow read, write: if request.auth != null;
    }
  }
}
